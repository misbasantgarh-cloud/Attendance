<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>NRLM Attendance</title>

<style>
body { font-family: Arial; background:#eef2f5; padding:15px }
.card { background:#fff; padding:15px; border-radius:12px; margin-bottom:15px }
button { padding:10px; border:none; border-radius:8px; margin:5px; background:#2e7d32; color:#fff }
input, textarea { width:100%; padding:10px; margin:6px 0 }
</style>
</head>

<body>

<div class="card">
  <h3>ğŸ” Cadre Login</h3>
  <input id="mobile" placeholder="Mobile Number">
  <button onclick="login()">Login</button>
</div>

<div id="panel" class="card" style="display:none">
  <h3 id="name"></h3>

  <button onclick="mark('IN')">Mark IN</button>
  <button onclick="mark('OUT')">Mark OUT</button>

  <h4>Apply Leave</h4>
  <input type="date" id="from">
  <input type="date" id="to">
  <textarea id="reason" placeholder="Reason"></textarea>
  <button onclick="leave()">Apply Leave</button>

  <p id="msg"></p>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxrrCAZGkst_V8Zwz7mimr8PKqPO93J5E-7BKkcXcW3Pwaz4gaL5v5hMXQOdb-xDCHnAA/exec";
let user = {};

function login() {
  fetch(API_URL, {
    method:"POST",
    body:JSON.stringify({ action:"login", mobile: mobile.value })
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.error) return alert(d.error);
    user=d;
    panel.style.display="block";
    name.innerText = "Welcome " + d.name;
  });
}

function mark(type) {
  navigator.geolocation.getCurrentPosition(p=>{
    fetch(API_URL,{
      method:"POST",
      body:JSON.stringify({
        action:"attendance",
        type,
        mobile:user.mobile,
        name:user.name,
        lat:p.coords.latitude,
        lng:p.coords.longitude,
        allowedLat:user.lat,
        allowedLng:user.lng,
        radius:user.radius
      })
    })
    .then(r=>r.json())
    .then(d=>msg.innerText=d.message || d.error);
  },()=>alert("Location permission required"));
}

function leave() {
  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"leave",
      mobile:user.mobile,
      name:user.name,
      from:from.value,
      to:to.value,
      reason:reason.value
    })
  })
  .then(r=>r.json())
  .then(d=>alert(d.message || d.error));
}
</script>

</body>
</html>
